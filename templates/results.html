<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assessment Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 py-10">

<div class="max-w-5xl mx-auto bg-white rounded-3xl shadow-lg p-8">
  <h1 class="text-3xl font-bold text-indigo-600 mb-6 text-center">Your Skill Profile</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Chart -->
    <div class="p-6 bg-gray-50 rounded-xl flex items-center justify-center">
      <canvas id="resultsChart" class="w-full h-64 md:h-80"></canvas>
    </div>

    <!-- Strengths + Suggestions -->
    <div class="p-6 bg-indigo-50 rounded-xl">
      <h2 class="text-xl font-bold mb-4 text-indigo-700">Your Insights</h2>
      <ul class="list-disc pl-6 text-gray-700 space-y-4">
        {% for skill, score in category_scores.items() %}
          {% set percent = (score / 5 * 100) | round(0) %}
          {% if percent >= 80 %}
            <li>
              <span class="font-semibold">{{ skill }}</span> â€” Excellent ({{ percent }}%)  
              <p class="text-sm text-green-700 ml-4">ðŸ’¡ Suggestion: Keep sharpening this skill by tackling advanced projects or mentoring others.</p>
            </li>
          {% elif percent >= 60 %}
            <li>
              <span class="font-semibold">{{ skill }}</span> â€” Good ({{ percent }}%)  
              <p class="text-sm text-blue-700 ml-4">ðŸ’¡ Suggestion: Enhance further by joining workshops or practicing real-world problems.</p>
            </li>
          {% else %}
            <li>
              <span class="font-semibold">{{ skill }}</span> â€” Needs Improvement ({{ percent }}%)  
              <p class="text-sm text-red-700 ml-4">ðŸ’¡ Suggestion: Focus on basics, take online courses, and practice step by step.</p>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>

<div class="mt-8 text-center space-x-4">
  <a href="/assessment" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl shadow-md hover:shadow-xl transition-all">
    Retake Assessment
  </a>

  <a href="/dashboard" class="px-6 py-3 bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-xl shadow-md hover:shadow-xl transition-all">
    Back to Dashboard
  </a>
</div>

</div>

<script>
  const ctx = document.getElementById('resultsChart');

  // Convert scores (max=5) into percentages
  const rawScores = {{ category_scores.values()|list|tojson }};
  const data = rawScores.map(s => (s / 5 * 100).toFixed(0));

  const labels = {{ category_scores.keys()|list|tojson }};

  // Generate dynamic colors for each skill
  const colors = [
    'rgba(99, 102, 241, 0.7)',   // Indigo
    'rgba(139, 92, 246, 0.7)',   // Purple
    'rgba(16, 185, 129, 0.7)',   // Green
    'rgba(245, 158, 11, 0.7)',   // Amber
    'rgba(239, 68, 68, 0.7)',    // Red
    'rgba(37, 99, 235, 0.7)',    // Blue
    'rgba(236, 72, 153, 0.7)'    // Pink
  ];

  const chartColors = labels.map((_, i) => colors[i % colors.length]);

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Skill %',
        data: data,
        backgroundColor: chartColors,
        borderColor: chartColors.map(c => c.replace('0.7', '1')),
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }, // Hide legend for bar chart
        tooltip: {
          callbacks: {
            label: function(ctx) {
              return `${ctx.label}: ${ctx.parsed.y}%`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          ticks: {
            callback: function(value) { return value + '%'; }
          },
          title: {
            display: true,
            text: 'Percentage'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Skills'
          }
        }
      }
    }
  });
</script>

</body>
</html>
